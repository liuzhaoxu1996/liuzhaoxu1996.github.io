<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>9. LRU Cache的实现、应用和题解 | Zhaoxu Liu</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Zhaoxu Liu">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.b5f0b03a.css" as="style"><link rel="preload" href="/assets/js/app.07bc8ac9.js" as="script"><link rel="preload" href="/assets/js/2.54df97aa.js" as="script"><link rel="preload" href="/assets/js/11.e64c384a.js" as="script"><link rel="prefetch" href="/assets/js/10.f289ec56.js"><link rel="prefetch" href="/assets/js/100.9d553a15.js"><link rel="prefetch" href="/assets/js/101.30d35580.js"><link rel="prefetch" href="/assets/js/102.b5ba3877.js"><link rel="prefetch" href="/assets/js/103.5f080aeb.js"><link rel="prefetch" href="/assets/js/104.ab7af729.js"><link rel="prefetch" href="/assets/js/105.93deeee5.js"><link rel="prefetch" href="/assets/js/106.bc89b6d0.js"><link rel="prefetch" href="/assets/js/107.dac720bd.js"><link rel="prefetch" href="/assets/js/108.1f3bb1dd.js"><link rel="prefetch" href="/assets/js/109.4ceac602.js"><link rel="prefetch" href="/assets/js/110.4605645b.js"><link rel="prefetch" href="/assets/js/111.cc1ef84e.js"><link rel="prefetch" href="/assets/js/12.5d143ad4.js"><link rel="prefetch" href="/assets/js/13.6227cbaa.js"><link rel="prefetch" href="/assets/js/14.d52677da.js"><link rel="prefetch" href="/assets/js/15.4fa77a68.js"><link rel="prefetch" href="/assets/js/16.57c8322b.js"><link rel="prefetch" href="/assets/js/17.4b245436.js"><link rel="prefetch" href="/assets/js/18.1b195508.js"><link rel="prefetch" href="/assets/js/19.db2151d7.js"><link rel="prefetch" href="/assets/js/20.f3f9df2a.js"><link rel="prefetch" href="/assets/js/21.51f62eb2.js"><link rel="prefetch" href="/assets/js/22.977925cc.js"><link rel="prefetch" href="/assets/js/23.8efab876.js"><link rel="prefetch" href="/assets/js/24.4ee586eb.js"><link rel="prefetch" href="/assets/js/25.11ba3208.js"><link rel="prefetch" href="/assets/js/26.1de172c6.js"><link rel="prefetch" href="/assets/js/27.f0311b69.js"><link rel="prefetch" href="/assets/js/28.fae550dc.js"><link rel="prefetch" href="/assets/js/29.7b8b91e6.js"><link rel="prefetch" href="/assets/js/3.1a64a66a.js"><link rel="prefetch" href="/assets/js/30.0e1868ab.js"><link rel="prefetch" href="/assets/js/31.06222bc4.js"><link rel="prefetch" href="/assets/js/32.47450fe1.js"><link rel="prefetch" href="/assets/js/33.bacbefde.js"><link rel="prefetch" href="/assets/js/34.27dd37c1.js"><link rel="prefetch" href="/assets/js/35.0b361b38.js"><link rel="prefetch" href="/assets/js/36.691f2c9d.js"><link rel="prefetch" href="/assets/js/37.19d2da36.js"><link rel="prefetch" href="/assets/js/38.8ec9b94d.js"><link rel="prefetch" href="/assets/js/39.fabfcff6.js"><link rel="prefetch" href="/assets/js/4.18b7f171.js"><link rel="prefetch" href="/assets/js/40.3dc66611.js"><link rel="prefetch" href="/assets/js/41.889ab4e5.js"><link rel="prefetch" href="/assets/js/42.33865746.js"><link rel="prefetch" href="/assets/js/43.2073ebe1.js"><link rel="prefetch" href="/assets/js/44.0fbfc8ea.js"><link rel="prefetch" href="/assets/js/45.c5795cee.js"><link rel="prefetch" href="/assets/js/46.3ab420b3.js"><link rel="prefetch" href="/assets/js/47.b447b4a8.js"><link rel="prefetch" href="/assets/js/48.f7c3f597.js"><link rel="prefetch" href="/assets/js/49.9d165572.js"><link rel="prefetch" href="/assets/js/5.718994b1.js"><link rel="prefetch" href="/assets/js/50.3cc9de09.js"><link rel="prefetch" href="/assets/js/51.472663c3.js"><link rel="prefetch" href="/assets/js/52.11796b68.js"><link rel="prefetch" href="/assets/js/53.b1e7bf26.js"><link rel="prefetch" href="/assets/js/54.0fcce785.js"><link rel="prefetch" href="/assets/js/55.1d1cc58b.js"><link rel="prefetch" href="/assets/js/56.413107d6.js"><link rel="prefetch" href="/assets/js/57.705d29b5.js"><link rel="prefetch" href="/assets/js/58.69b8f4be.js"><link rel="prefetch" href="/assets/js/59.dc4ad713.js"><link rel="prefetch" href="/assets/js/6.eafd2c6f.js"><link rel="prefetch" href="/assets/js/60.03da4f70.js"><link rel="prefetch" href="/assets/js/61.dcae5138.js"><link rel="prefetch" href="/assets/js/62.b5787962.js"><link rel="prefetch" href="/assets/js/63.ac5e7a71.js"><link rel="prefetch" href="/assets/js/64.ccc02967.js"><link rel="prefetch" href="/assets/js/65.543c9ff7.js"><link rel="prefetch" href="/assets/js/66.4b8131a8.js"><link rel="prefetch" href="/assets/js/67.0e690903.js"><link rel="prefetch" href="/assets/js/68.2aff0cff.js"><link rel="prefetch" href="/assets/js/69.192eeeee.js"><link rel="prefetch" href="/assets/js/7.368c0350.js"><link rel="prefetch" href="/assets/js/70.b52584ac.js"><link rel="prefetch" href="/assets/js/71.36a19599.js"><link rel="prefetch" href="/assets/js/72.9f13ca31.js"><link rel="prefetch" href="/assets/js/73.27c81fb7.js"><link rel="prefetch" href="/assets/js/74.fd0408a1.js"><link rel="prefetch" href="/assets/js/75.7a09263f.js"><link rel="prefetch" href="/assets/js/76.232b5252.js"><link rel="prefetch" href="/assets/js/77.4493ea6f.js"><link rel="prefetch" href="/assets/js/78.48d5a87c.js"><link rel="prefetch" href="/assets/js/79.8a784179.js"><link rel="prefetch" href="/assets/js/8.d250195f.js"><link rel="prefetch" href="/assets/js/80.d1a94db6.js"><link rel="prefetch" href="/assets/js/81.46d2cc59.js"><link rel="prefetch" href="/assets/js/82.8d2109b0.js"><link rel="prefetch" href="/assets/js/83.fa79cd42.js"><link rel="prefetch" href="/assets/js/84.32bbde64.js"><link rel="prefetch" href="/assets/js/85.87e66000.js"><link rel="prefetch" href="/assets/js/86.c57b4846.js"><link rel="prefetch" href="/assets/js/87.2e92d4cf.js"><link rel="prefetch" href="/assets/js/88.0e951151.js"><link rel="prefetch" href="/assets/js/89.b9d398e6.js"><link rel="prefetch" href="/assets/js/9.ddd09617.js"><link rel="prefetch" href="/assets/js/90.2d3d5d2d.js"><link rel="prefetch" href="/assets/js/91.a0321263.js"><link rel="prefetch" href="/assets/js/92.5c0eabfe.js"><link rel="prefetch" href="/assets/js/93.23398d7a.js"><link rel="prefetch" href="/assets/js/94.36ade5b0.js"><link rel="prefetch" href="/assets/js/95.bba70dd1.js"><link rel="prefetch" href="/assets/js/96.7418a5da.js"><link rel="prefetch" href="/assets/js/97.dcc6d772.js"><link rel="prefetch" href="/assets/js/98.94f9e4b6.js"><link rel="prefetch" href="/assets/js/99.8c40a74c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b5f0b03a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zhaoxu Liu</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/1.html" class="nav-link">
  博文
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="归档" class="dropdown-title"><span class="title">归档</span> <span class="arrow down"></span></button> <button type="button" aria-label="归档" class="mobile-dropdown-title"><span class="title">归档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/go/1.html" class="nav-link">
  go
</a></li><li class="dropdown-item"><!----> <a href="/document/java/1.html" class="nav-link">
  java
</a></li><li class="dropdown-item"><!----> <a href="/document/flutter/init.html" class="nav-link">
  flutter
</a></li><li class="dropdown-item"><!----> <a href="/document/webpack/introduction.html" class="nav-link">
  webpack5
</a></li><li class="dropdown-item"><!----> <a href="/document/tensorflow/1.html" class="nav-link">
  tensorflow
</a></li><li class="dropdown-item"><!----> <a href="/document/mysql/1.html" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/document/nodejs/1.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/document/interview/javascript.html" class="nav-link">
  面试
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="读书笔记" class="mobile-dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/book/functional/first.html" class="nav-link">
  JavaScript函数式编程指南
</a></li><li class="dropdown-item"><!----> <a href="/book/professional/1.html" class="nav-link">
  JavaScript高级程序设计
</a></li></ul></div></div><div class="nav-item"><a href="/algorithm/2.html" class="nav-link">
  算法
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/1.html" class="nav-link">
  博文
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="归档" class="dropdown-title"><span class="title">归档</span> <span class="arrow down"></span></button> <button type="button" aria-label="归档" class="mobile-dropdown-title"><span class="title">归档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/go/1.html" class="nav-link">
  go
</a></li><li class="dropdown-item"><!----> <a href="/document/java/1.html" class="nav-link">
  java
</a></li><li class="dropdown-item"><!----> <a href="/document/flutter/init.html" class="nav-link">
  flutter
</a></li><li class="dropdown-item"><!----> <a href="/document/webpack/introduction.html" class="nav-link">
  webpack5
</a></li><li class="dropdown-item"><!----> <a href="/document/tensorflow/1.html" class="nav-link">
  tensorflow
</a></li><li class="dropdown-item"><!----> <a href="/document/mysql/1.html" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/document/nodejs/1.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/document/interview/javascript.html" class="nav-link">
  面试
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="读书笔记" class="mobile-dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/book/functional/first.html" class="nav-link">
  JavaScript函数式编程指南
</a></li><li class="dropdown-item"><!----> <a href="/book/professional/1.html" class="nav-link">
  JavaScript高级程序设计
</a></li></ul></div></div><div class="nav-item"><a href="/algorithm/2.html" class="nav-link">
  算法
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>算法</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/algorithm/2.html" class="sidebar-link">2. 哈希表 映射 集合</a></li><li><a href="/algorithm/3.html" class="sidebar-link">3. 树、二叉树、二叉搜索树的实现和特性</a></li><li><a href="/algorithm/4.html" class="sidebar-link">4. 图的实现和特性</a></li><li><a href="/algorithm/8.html" class="sidebar-link">8. 布隆过滤器(Bloom Filter)的原理和实现</a></li><li><a href="/algorithm/9.html" aria-current="page" class="active sidebar-link">9. LRU Cache的实现、应用和题解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/algorithm/9.html#思路" class="sidebar-link">思路</a></li><li class="sidebar-sub-header"><a href="/algorithm/9.html#选择什么数据结构" class="sidebar-link">选择什么数据结构？</a></li><li class="sidebar-sub-header"><a href="/algorithm/9.html#双向链表、哈希表-存什么" class="sidebar-link">双向链表、哈希表，存什么？</a></li><li class="sidebar-sub-header"><a href="/algorithm/9.html#定义-listnode" class="sidebar-link">定义 ListNode</a></li><li class="sidebar-sub-header"><a href="/algorithm/9.html#定义-lrucache" class="sidebar-link">定义 LRUCache</a></li><li class="sidebar-sub-header"><a href="/algorithm/9.html#设计-dummyhead-和-dummytail-的意义" class="sidebar-link">设计 dummyHead 和 dummyTail 的意义</a></li><li class="sidebar-sub-header"><a href="/algorithm/9.html#get-方法实现" class="sidebar-link">get 方法实现</a></li><li class="sidebar-sub-header"><a href="/algorithm/9.html#put-方法实现" class="sidebar-link">put 方法实现</a></li><li class="sidebar-sub-header"><a href="/algorithm/9.html#整体代码" class="sidebar-link">整体代码</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_9-lru-cache的实现、应用和题解"><a href="#_9-lru-cache的实现、应用和题解" class="header-anchor">#</a> 9. LRU Cache的实现、应用和题解</h1> <p><img src="http://p4.qhimg.com/t012e82e1b0d0d3449e.png" alt=""></p> <h2 id="思路"><a href="#思路" class="header-anchor">#</a> 思路</h2> <ul><li>数据被读取了，就是被使用了，所在的位置要刷新，移动到“顶部”。</li> <li>写入数据时：
<ul><li>之前就有的，更新数据，刷新位置。</li> <li>之前没有的，有位置就直接写入，没有位置，就先删掉最久没有使用的条目，再写入。</li></ul></li> <li>题目说 get 和 put 都要是 O(1)O(1)，这俩操作都可能导致条目的移动，这包含删除操作，所以删除操作也要是 O(1)O(1)。</li></ul> <h2 id="选择什么数据结构"><a href="#选择什么数据结构" class="header-anchor">#</a> 选择什么数据结构？</h2> <ul><li>O(1)O(1) 的数据快速查找，就哈希表了。</li> <li>光靠哈希表可以吗？
<ul><li>哈希表是无序的，无法知道里面键值对哪些最近访问过，哪些很久没访问。</li></ul></li> <li>快速删除，谁合适？
<ul><li>数组？元素的插入和移动是 O(n)O(n)，删除元素也是 O(n)O(n)。不行。</li> <li>单向链表？删除节点需要访问前驱节点，只能花 O(n)O(n) 从前遍历查找。不行。</li> <li>双向链表，结点有前驱指针，删除和移动节点都是指针的变动，都是 O(1)O(1)。</li></ul></li></ul> <h2 id="双向链表、哈希表-存什么"><a href="#双向链表、哈希表-存什么" class="header-anchor">#</a> 双向链表、哈希表，存什么？</h2> <ul><li>链表结点：存 key 和 对应的数据值。</li> <li>哈希表的存在，就是为了快速访问到存储于双向链表的数据：
<ul><li>key：存双向链表中存的 key</li> <li>value：存链表结点的引用。</li></ul></li></ul> <h2 id="定义-listnode"><a href="#定义-listnode" class="header-anchor">#</a> 定义 ListNode</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ListNode</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key     
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>prev <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="定义-lrucache"><a href="#定义-lrucache" class="header-anchor">#</a> 定义 LRUCache</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">LRUCache</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">capacity</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     
    <span class="token keyword">this</span><span class="token punctuation">.</span>capacity <span class="token operator">=</span> capacity  <span class="token comment">// 缓存的容量</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>            <span class="token comment">// 哈希表</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>            <span class="token comment">// 缓存数目</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 虚拟头结点</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dummyTail <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 虚拟尾节点</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyTail
    <span class="token keyword">this</span><span class="token punctuation">.</span>dummyTail<span class="token punctuation">.</span>prev <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead <span class="token comment">// 相联系</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="设计-dummyhead-和-dummytail-的意义"><a href="#设计-dummyhead-和-dummytail-的意义" class="header-anchor">#</a> 设计 dummyHead 和 dummyTail 的意义</h2> <ul><li>虚拟头尾节点，不存数据，只是为了让真实头尾节点的操作，和其他节点一致，方便快速访问头尾节点。</li> <li>初始还没有添加真实节点，要将虚拟头尾节点联结在一起。</li></ul> <h2 id="get-方法实现"><a href="#get-方法实现" class="header-anchor">#</a> get 方法实现</h2> <ul><li>哈希表中找不到对应的值，则返回 -1。被读取的节点，要刷新它的位置，移动到链表头部</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span>      <span class="token comment">// 从哈希表中，获取对应的节点</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token comment">// 如果节点不存在，返回-1</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">moveToHead</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>          <span class="token comment">// 被读取了，该节点移动到链表头部</span>
  <span class="token keyword">return</span> node<span class="token punctuation">.</span>value              <span class="token comment">// 返回出节点值</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>moveToHead方法实现</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">moveToHead</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeFromList</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token comment">// 从链表中删除节点</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addToHead</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>      <span class="token comment">// 添加到链表的头部</span>
<span class="token punctuation">}</span>
<span class="token function">removeFromList</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        
  <span class="token keyword">let</span> temp1 <span class="token operator">=</span> node<span class="token punctuation">.</span>prev     <span class="token comment">// 暂存它的后继节点</span>
  <span class="token keyword">let</span> temp2 <span class="token operator">=</span> node<span class="token punctuation">.</span>next     <span class="token comment">// 暂存它的前驱节点</span>
  temp1<span class="token punctuation">.</span>next <span class="token operator">=</span> temp2        <span class="token comment">// 前驱节点的next指向后继节点</span>
  temp2<span class="token punctuation">.</span>prev <span class="token operator">=</span> temp1        <span class="token comment">// 后继节点的prev指向前驱节点</span>
<span class="token punctuation">}</span>
<span class="token function">addToHead</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                 <span class="token comment">// 插入到虚拟头结点和真实头结点之间</span>
  node<span class="token punctuation">.</span>prev <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead      <span class="token comment">// node的prev指针，指向虚拟头结点</span>
  node<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead<span class="token punctuation">.</span>next <span class="token comment">// node的next指针，指向原来的真实头结点</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead<span class="token punctuation">.</span>next<span class="token punctuation">.</span>prev <span class="token operator">=</span> node <span class="token comment">// 原来的真实头结点的prev，指向node</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead<span class="token punctuation">.</span>next <span class="token operator">=</span> node      <span class="token comment">// 虚拟头结点的next，指向node</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="put-方法实现"><a href="#put-方法实现" class="header-anchor">#</a> put 方法实现</h2> <ul><li>写入新数据，先检查容量，决定是否删“老家伙”，然后创建新的节点，添加到链表头部(最不优先被淘汰)，映射到哈希表。</li> <li>写入已有的数据，则更新数据值，刷新节点的位置。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">put</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span>            <span class="token comment">// 获取链表中的node</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token comment">// 不存在于链表，是新数据</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 容量已满</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeLRUItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token comment">// 删除最远一次使用的数据</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token comment">// 创建新的节点</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newNode          <span class="token comment">// 存入哈希表</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addToHead</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span>           <span class="token comment">// 将节点添加到链表头部</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>                      <span class="token comment">// 缓存数目+1</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                   <span class="token comment">// 已经存在于链表，老数据</span>
    node<span class="token punctuation">.</span>value <span class="token operator">=</span> value       <span class="token comment">// 更新value</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">moveToHead</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>    <span class="token comment">// 将节点移到链表头部</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>removeLRUItem 方法实现</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">removeLRUItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token comment">// 删除“老家伙”</span>
  <span class="token keyword">let</span> tail <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">popTail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment">// 将它从链表尾部删除</span>
  <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hash<span class="token punctuation">[</span>tail<span class="token punctuation">.</span>key<span class="token punctuation">]</span>    <span class="token comment">// 哈希表中也将它删除</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">--</span>                  <span class="token comment">// 缓存数目-1</span>
<span class="token punctuation">}</span>
<span class="token function">popTail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                      <span class="token comment">// 删除链表尾节点</span>
  <span class="token keyword">let</span> tail <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyTail<span class="token punctuation">.</span>prev <span class="token comment">// 通过虚拟尾节点找到它</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeFromList</span><span class="token punctuation">(</span>tail<span class="token punctuation">)</span>      <span class="token comment">// 删除该真实尾节点</span>
  <span class="token keyword">return</span> tail                    <span class="token comment">// 返回被删除的节点</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="整体代码"><a href="#整体代码" class="header-anchor">#</a> 整体代码</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ListNode</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>prev <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">LRUCache</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">capacity</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>capacity <span class="token operator">=</span> capacity
    <span class="token keyword">this</span><span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dummyTail <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyTail
    <span class="token keyword">this</span><span class="token punctuation">.</span>dummyTail<span class="token punctuation">.</span>prev <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead
  <span class="token punctuation">}</span>

  <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">moveToHead</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token keyword">return</span> node<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span>

  <span class="token function">put</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeLRUItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hash<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newNode
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addToHead</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>value <span class="token operator">=</span> value
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">moveToHead</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">moveToHead</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeFromList</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addToHead</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">removeFromList</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> temp1 <span class="token operator">=</span> node<span class="token punctuation">.</span>prev
    <span class="token keyword">let</span> temp2 <span class="token operator">=</span> node<span class="token punctuation">.</span>next
    temp1<span class="token punctuation">.</span>next <span class="token operator">=</span> temp2
    temp2<span class="token punctuation">.</span>prev <span class="token operator">=</span> temp1
  <span class="token punctuation">}</span>

  <span class="token function">addToHead</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    node<span class="token punctuation">.</span>prev <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead
    node<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead<span class="token punctuation">.</span>next
    <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead<span class="token punctuation">.</span>next<span class="token punctuation">.</span>prev <span class="token operator">=</span> node
    <span class="token keyword">this</span><span class="token punctuation">.</span>dummyHead<span class="token punctuation">.</span>next <span class="token operator">=</span> node
  <span class="token punctuation">}</span>

  <span class="token function">removeLRUItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tail <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">popTail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hash<span class="token punctuation">[</span>tail<span class="token punctuation">.</span>key<span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">--</span>
  <span class="token punctuation">}</span>

  <span class="token function">popTail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tail <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyTail<span class="token punctuation">.</span>prev
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeFromList</span><span class="token punctuation">(</span>tail<span class="token punctuation">)</span>
    <span class="token keyword">return</span> tail
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/algorithm/8.html" class="prev">
        8. 布隆过滤器(Bloom Filter)的原理和实现
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.07bc8ac9.js" defer></script><script src="/assets/js/2.54df97aa.js" defer></script><script src="/assets/js/11.e64c384a.js" defer></script>
  </body>
</html>
